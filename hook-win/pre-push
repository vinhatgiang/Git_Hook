#!/bin/bash

# Git Hook: pre-push
# Platform: Git Bash (Windows, macOS, Linux)
# Purpose: Prevent push to protected branches

show_dialog() {
    msg="$1"
    title="$2"
    powershell.exe -WindowStyle Hidden -Command "Add-Type -AssemblyName System.Windows.Forms; [System.Windows.Forms.MessageBox]::Show('$msg', '$title')" > /dev/null
}

protected_branches=("main" "develop")

current_branch=$(git symbolic-ref --short HEAD 2>/dev/null)

for branch in "${protected_branches[@]}"; do
    if [[ "$current_branch" == "$branch" ]]; then
        echo "❌ Push to $branch is blocked. Please use a feature branch and create a Pull Request."
        show_dialog "Push to $branch is blocked.\nPlease use a feature branch and create a Pull Request." "Push Blocked"
        exit 1
    fi

done

echo "✅ Pre-push checks passed"
exit 0
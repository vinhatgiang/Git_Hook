#!/bin/bash

# Git Hook: pre-commit
# Platform: Git Bash (Windows, macOS, Linux)
# Purpose: Prevent commits to main and develop branches

show_dialog() {
    msg="$1"
    title="$2"
    powershell.exe -WindowStyle Hidden -Command "Add-Type -AssemblyName System.Windows.Forms; [System.Windows.Forms.MessageBox]::Show('$msg', '$title')" > /dev/null
}

current_branch=$(git symbolic-ref --short HEAD 2>/dev/null)

if [[ "$current_branch" == "main" ]]; then
    echo
    echo "COMMIT TO MAIN BRANCH BLOCKED"
    echo "You are trying to commit directly to the main branch."
    echo "This action is prohibited for code safety and review process."
    show_dialog "You are trying to commit directly to the main branch. This action is prohibited for code safety and review process."
    exit 1
fi

if [[ "$current_branch" == "develop" ]]; then
    echo
    echo "COMMIT TO DEVELOP BRANCH BLOCKED"
    echo "You are trying to commit directly to the develop branch."
    echo "This action is prohibited for development workflow integrity."
    show_dialog "You are trying to commit directly to the develop branch. This action is prohibited for development workflow."
    exit 1
fi

echo "Pre-commit checks passed"
exit 0
